{
  "id": "partitioning",
  "title": "Partitioning (Advanced Production)",
  "description": "Scale large tables using table partitioning for improved query performance and data management.",
  "code": "-- Partition orders by created_at (monthly)\nCREATE TABLE orders (\n  id SERIAL,\n  order_number VARCHAR(50),\n  user_id INT,\n  total_amount DECIMAL(10,2),\n  status VARCHAR(20),\n  created_at TIMESTAMP NOT NULL,\n  PRIMARY KEY (id, created_at)\n) PARTITION BY RANGE (created_at);\n\n-- Partition payments by status\nCREATE TABLE payments (\n  id SERIAL,\n  order_id INT,\n  amount DECIMAL(10,2),\n  status VARCHAR(20) NOT NULL,\n  created_at TIMESTAMP,\n  PRIMARY KEY (id, status)\n) PARTITION BY LIST (status);\n\n-- Partition stock_reservations by expires_at\nCREATE TABLE stock_reservations (\n  id SERIAL,\n  product_id INT,\n  quantity INT,\n  expires_at TIMESTAMP NOT NULL,\n  PRIMARY KEY (id, expires_at)\n) PARTITION BY RANGE (expires_at);",
  "example": "-- Create yearly partition for orders\nCREATE TABLE orders_2024 PARTITION OF orders\nFOR VALUES FROM ('2024-01-01') TO ('2025-01-01');\n\nCREATE TABLE orders_2025 PARTITION OF orders\nFOR VALUES FROM ('2025-01-01') TO ('2026-01-01');\n\n-- Move old orders to archive partition\nCREATE TABLE orders_archive PARTITION OF orders\nFOR VALUES FROM ('2020-01-01') TO ('2023-01-01');\n\n-- Query only current month partition\nSELECT * FROM orders\nWHERE created_at >= '2024-12-01' \n  AND created_at < '2025-01-01';\n-- PostgreSQL automatically routes to correct partition\n\n-- Compare performance with partition vs no partition\n-- With partition: Query only scans relevant partition\nEXPLAIN ANALYZE\nSELECT * FROM orders\nWHERE created_at >= '2024-12-01' \n  AND created_at < '2025-01-01';\n\n-- Create partitioned index\nCREATE INDEX idx_orders_user ON orders(user_id);\n-- Index is automatically created on all partitions\n\n-- Attach new partition\nCREATE TABLE orders_2026 (\n  LIKE orders INCLUDING ALL\n);\nALTER TABLE orders ATTACH PARTITION orders_2026\nFOR VALUES FROM ('2026-01-01') TO ('2027-01-01');\n\n-- Detach old partition\nALTER TABLE orders DETACH PARTITION orders_2020;\n\n-- Create monthly partitions\nCREATE TABLE orders_2024_01 PARTITION OF orders\nFOR VALUES FROM ('2024-01-01') TO ('2024-02-01');\n\nCREATE TABLE orders_2024_02 PARTITION OF orders\nFOR VALUES FROM ('2024-02-01') TO ('2024-03-01');\n\n-- List partition by status\nCREATE TABLE payments_completed PARTITION OF payments\nFOR VALUES IN ('completed');\n\nCREATE TABLE payments_pending PARTITION OF payments\nFOR VALUES IN ('pending', 'processing');\n\nCREATE TABLE payments_failed PARTITION OF payments\nFOR VALUES IN ('failed', 'cancelled');",
  "useCase": "Large datasets, time-series data, archiving, performance at scale, data lifecycle management",
  "category": "Advanced Features"
}
