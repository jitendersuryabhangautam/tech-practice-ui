{
  "id": "query-optimization",
  "title": "Query Optimization",
  "description": "Techniques to improve query performance and efficiency.",
  "code": "-- CANONICAL E-COMMERCE SCHEMA\nCREATE TABLE users (\n  id SERIAL PRIMARY KEY,\n  first_name VARCHAR(100) NOT NULL,\n  last_name VARCHAR(100) NOT NULL,\n  email VARCHAR(255) UNIQUE NOT NULL,\n  role VARCHAR(20) NOT NULL DEFAULT 'customer',\n  created_at TIMESTAMP DEFAULT NOW(),\n  updated_at TIMESTAMP DEFAULT NOW()\n);\n\nCREATE TABLE products (\n  id SERIAL PRIMARY KEY,\n  name VARCHAR(255) NOT NULL,\n  sku VARCHAR(100) UNIQUE NOT NULL,\n  price DECIMAL(10,2) NOT NULL,\n  stock_quantity INT NOT NULL DEFAULT 0,\n  category VARCHAR(100),\n  image_url TEXT,\n  created_at TIMESTAMP DEFAULT NOW(),\n  updated_at TIMESTAMP DEFAULT NOW()\n);\n\nCREATE TABLE orders (\n  id SERIAL PRIMARY KEY,\n  order_number VARCHAR(50) UNIQUE NOT NULL,\n  user_id INT NOT NULL REFERENCES users(id),\n  total_amount DECIMAL(10,2) NOT NULL,\n  status VARCHAR(20) NOT NULL,\n  payment_method VARCHAR(20),\n  shipping_address JSONB,\n  billing_address JSONB,\n  created_at TIMESTAMP DEFAULT NOW(),\n  updated_at TIMESTAMP DEFAULT NOW()\n);\n\nCREATE TABLE order_items (\n  id SERIAL PRIMARY KEY,\n  order_id INT NOT NULL REFERENCES orders(id),\n  product_id INT NOT NULL REFERENCES products(id),\n  quantity INT NOT NULL,\n  price_at_time DECIMAL(10,2) NOT NULL\n);\n\nCREATE TABLE payments (\n  id SERIAL PRIMARY KEY,\n  order_id INT NOT NULL REFERENCES orders(id),\n  amount DECIMAL(10,2) NOT NULL,\n  payment_method VARCHAR(20) NOT NULL,\n  status VARCHAR(20) NOT NULL,\n  transaction_id VARCHAR(100),\n  created_at TIMESTAMP DEFAULT NOW()\n);\n\n-- EXPLAIN ANALYZE\nEXPLAIN ANALYZE \nSELECT * FROM orders \nWHERE created_at > NOW() - INTERVAL '30 days';\n\n-- Avoid SELECT *\nSELECT id, first_name, last_name, email FROM users; -- Better\nSELECT * FROM users; -- Avoid\n\n-- Use LIMIT\nSELECT * FROM orders \nORDER BY created_at DESC \nLIMIT 100;\n\n-- Indexes for WHERE, JOIN, ORDER BY\nCREATE INDEX idx_orders_created_at ON orders(created_at);\nCREATE INDEX idx_order_items_order_id ON order_items(order_id);\n\n-- Use EXISTS instead of COUNT\nSELECT EXISTS(SELECT 1 FROM users WHERE email = 'test@example.com');\n-- Instead of: SELECT COUNT(*) > 0 FROM users WHERE...",
  "example": "-- Avoid OR, use UNION\nSELECT * FROM products WHERE category = 'Electronics'\nUNION\nSELECT * FROM products WHERE category = 'Computers';\n\n-- Use BETWEEN instead of >= AND <=\nSELECT * FROM orders \nWHERE created_at BETWEEN '2024-01-01' AND '2024-12-31';\n\n-- Avoid functions on indexed columns\n-- Bad: WHERE LOWER(email) = 'test@example.com'\n-- Good: WHERE email = 'test@example.com'\n\n-- Use prepared statements\nPREPARE user_query AS \nSELECT * FROM users WHERE id = $1;\nEXECUTE user_query(5);",
  "useCase": "Performance tuning, reducing query time, scalability, production optimization",
  "category": "Performance & Optimization"
}
