{
  "id": "transactions",
  "title": "Transactions",
  "description": "Group multiple operations into atomic units - all succeed or all fail.",
  "code": "-- CANONICAL E-COMMERCE SCHEMA\nCREATE TABLE users (\n  id SERIAL PRIMARY KEY,\n  first_name VARCHAR(100) NOT NULL,\n  last_name VARCHAR(100) NOT NULL,\n  email VARCHAR(255) UNIQUE NOT NULL,\n  role VARCHAR(20) NOT NULL DEFAULT 'customer',\n  created_at TIMESTAMP DEFAULT NOW(),\n  updated_at TIMESTAMP DEFAULT NOW()\n);\n\nCREATE TABLE products (\n  id SERIAL PRIMARY KEY,\n  name VARCHAR(255) NOT NULL,\n  sku VARCHAR(100) UNIQUE NOT NULL,\n  price DECIMAL(10,2) NOT NULL,\n  stock_quantity INT NOT NULL DEFAULT 0,\n  category VARCHAR(100),\n  image_url TEXT,\n  created_at TIMESTAMP DEFAULT NOW(),\n  updated_at TIMESTAMP DEFAULT NOW()\n);\n\nCREATE TABLE orders (\n  id SERIAL PRIMARY KEY,\n  order_number VARCHAR(50) UNIQUE NOT NULL,\n  user_id INT NOT NULL REFERENCES users(id),\n  total_amount DECIMAL(10,2) NOT NULL,\n  status VARCHAR(20) NOT NULL,\n  payment_method VARCHAR(20),\n  shipping_address JSONB,\n  billing_address JSONB,\n  created_at TIMESTAMP DEFAULT NOW(),\n  updated_at TIMESTAMP DEFAULT NOW()\n);\n\nCREATE TABLE order_items (\n  id SERIAL PRIMARY KEY,\n  order_id INT NOT NULL REFERENCES orders(id),\n  product_id INT NOT NULL REFERENCES products(id),\n  quantity INT NOT NULL,\n  price_at_time DECIMAL(10,2) NOT NULL\n);\n\nCREATE TABLE payments (\n  id SERIAL PRIMARY KEY,\n  order_id INT NOT NULL REFERENCES orders(id),\n  amount DECIMAL(10,2) NOT NULL,\n  payment_method VARCHAR(20) NOT NULL,\n  status VARCHAR(20) NOT NULL,\n  transaction_id VARCHAR(100),\n  created_at TIMESTAMP DEFAULT NOW()\n);\n\n-- Basic transaction\nBEGIN;\nUPDATE orders SET status = 'processing' WHERE id = 1;\nINSERT INTO payments (order_id, amount, payment_method, status) VALUES (1, 100.00, 'credit_card', 'completed');\nCOMMIT;\n\n-- Rollback on error\nBEGIN;\nUPDATE products SET stock_quantity = stock_quantity - 1 WHERE id = 1;\n-- Something goes wrong\nROLLBACK;\n\n-- Savepoints\nBEGIN;\nINSERT INTO orders (order_number, user_id, total_amount, status) VALUES ('ORD-001', 1, 50.00, 'pending');\nSAVEPOINT my_savepoint;\nINSERT INTO order_items (order_id, product_id, quantity, price_at_time) VALUES (1, 1, 2, 25.00);\n-- Oops, error occurred\nROLLBACK TO my_savepoint;\nCOMMIT;",
  "example": "-- Transaction with error handling (in application)\n-- Python example\nconn.begin()\ntry:\n    cursor.execute(\"UPDATE accounts SET balance = balance - 100 WHERE id = %s\", (1,))\n    cursor.execute(\"UPDATE accounts SET balance = balance + 100 WHERE id = %s\", (2,))\n    conn.commit()\nexcept Exception as e:\n    conn.rollback()\n    raise e\n\n-- Isolation levels\nBEGIN TRANSACTION ISOLATION LEVEL SERIALIZABLE;\n-- Your queries\nCOMMIT;",
  "useCase": "Data consistency, banking operations, multi-step processes, preventing partial updates",
  "category": "Performance & Optimization"
}
