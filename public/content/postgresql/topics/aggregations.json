{
  "id": "aggregations",
  "title": "Aggregate Functions",
  "description": "Perform calculations on sets of rows: COUNT, SUM, AVG, MIN, MAX.",
  "code": "-- CANONICAL E-COMMERCE SCHEMA\nCREATE TABLE users (\n  id SERIAL PRIMARY KEY,\n  first_name VARCHAR(100) NOT NULL,\n  last_name VARCHAR(100) NOT NULL,\n  email VARCHAR(255) UNIQUE NOT NULL,\n  role VARCHAR(20) NOT NULL DEFAULT 'customer',\n  created_at TIMESTAMP DEFAULT NOW(),\n  updated_at TIMESTAMP DEFAULT NOW()\n);\n\nCREATE TABLE products (\n  id SERIAL PRIMARY KEY,\n  name VARCHAR(255) NOT NULL,\n  sku VARCHAR(100) UNIQUE NOT NULL,\n  price DECIMAL(10,2) NOT NULL,\n  stock_quantity INT NOT NULL DEFAULT 0,\n  category VARCHAR(100),\n  image_url TEXT,\n  created_at TIMESTAMP DEFAULT NOW(),\n  updated_at TIMESTAMP DEFAULT NOW()\n);\n\nCREATE TABLE orders (\n  id SERIAL PRIMARY KEY,\n  order_number VARCHAR(50) UNIQUE NOT NULL,\n  user_id INT NOT NULL REFERENCES users(id),\n  total_amount DECIMAL(10,2) NOT NULL,\n  status VARCHAR(20) NOT NULL,\n  payment_method VARCHAR(20),\n  shipping_address JSONB,\n  billing_address JSONB,\n  created_at TIMESTAMP DEFAULT NOW(),\n  updated_at TIMESTAMP DEFAULT NOW()\n);\n\nCREATE TABLE order_items (\n  id SERIAL PRIMARY KEY,\n  order_id INT NOT NULL REFERENCES orders(id),\n  product_id INT NOT NULL REFERENCES products(id),\n  quantity INT NOT NULL,\n  price_at_time DECIMAL(10,2) NOT NULL\n);\n\nCREATE TABLE payments (\n  id SERIAL PRIMARY KEY,\n  order_id INT NOT NULL REFERENCES orders(id),\n  amount DECIMAL(10,2) NOT NULL,\n  payment_method VARCHAR(20) NOT NULL,\n  status VARCHAR(20) NOT NULL,\n  transaction_id VARCHAR(100),\n  created_at TIMESTAMP DEFAULT NOW()\n);\n\n-- COUNT\nSELECT COUNT(*) FROM users;\nSELECT COUNT(DISTINCT role) FROM users;\n\n-- SUM\nSELECT SUM(total_amount) FROM orders;\n\n-- AVG\nSELECT AVG(price) FROM products;\n\n-- MIN and MAX\nSELECT MIN(price), MAX(price) FROM products;\n\n-- GROUP BY\nSELECT category, COUNT(*), AVG(price) \nFROM products \nGROUP BY category;\n\n-- HAVING (filter groups)\nSELECT category, AVG(price) as avg_price \nFROM products \nGROUP BY category \nHAVING AVG(price) > 100;",
  "example": "-- Multiple aggregations\nSELECT \n  category,\n  COUNT(*) as product_count,\n  SUM(stock) as total_stock,\n  AVG(price) as avg_price,\n  MIN(price) as min_price,\n  MAX(price) as max_price\nFROM products \nGROUP BY category \nORDER BY product_count DESC;\n\n-- GROUP BY multiple columns\nSELECT \n  DATE(created_at) as date,\n  status,\n  COUNT(*) as order_count,\n  SUM(total) as revenue\nFROM orders \nWHERE created_at >= NOW() - INTERVAL '7 days'\nGROUP BY DATE(created_at), status;",
  "useCase": "Reports, analytics, statistics, dashboards, summaries",
  "category": "Basic Queries"
}
